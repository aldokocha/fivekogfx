window.addEventListener("load",function(d){function u(d,h){function m(){redraw();a.load(d)}var a=new FivekoGFX,g=document.getElementById("controls");addFilter(new Filter("Box Blur",function(){this.add(createSlider(g,"sigmaSlider","Sigma",1.5,0,10,.5,this.update.bind(this)))},function(c){a.blur(c);a.draw(h)},m));addFilter(new Filter("Grayscale",function(){},function(c){a.rgb2grey(c);a.draw(h)},m));addFilter(new Filter("Gaussian Blur",function(){this.add(createSlider(g,"sigmaSlider","Sigma",1.5,0,10,
.5,this.update.bind(this)))},function(c){a.gauss(c);a.draw(h)},m));addFilter(new Filter("Sobel",function(){this.add(createSlider(g,"sigmaSlider","Gauss Sigma",1.5,0,10,.5,this.update.bind(this)))},function(c){a.blur(c);a.sobel();a.draw(h)},m));addFilter(new Filter("HoughCircle",function(){this.add(createSlider(g,"sizeSlider","Size",20,0,100,5,this.update.bind(this)));this.add(createSlider(g,"sigmaSlider","SigmaSobel",1.5,0,10,.5,this.update.bind(this)))},function(c,k){a.blur(k);a.sobel();a.houghCircle(c);
a.draw(h)},m));addFilter(new Filter("SymmenticNN",function(){this.add(createSlider(g,"sizeSlider","Size",3,0,10,1,this.update.bind(this)));this.add(createSlider(g,"countSlider","Count",1,0,10,1,this.update.bind(this)))},function(c,k){a.symmetricnn(parseInt(c),parseInt(k));a.draw(h)},m));addFilter(new Filter("Watershed",function(){this.add(createSlider(g,"sigmaSlider","Sigma",1,0,10,.5,this.update.bind(this)));this.add(createButton(g,"cmdExecute","Execute",this.update.bind(this)));this.seeds=[{pixels:[]},
{pixels:[]}];var c=this;h.onmousedown=h.onmousemove=function(a){if(a.buttons){var d=a.offsetX,g=a.offsetY;a=1==a.buttons?0:1;if(-1===c.seeds[a].pixels.indexOf(4*(d+g*h.width))){c.seeds[a].pixels.push(4*(d+g*h.width));var k=h.getContext("2d");k.fillStyle=a?"red":"green";k.fillRect(d,g,6,6)}}}.bind(this)},function(c){this.seeds[0].pixels.length&&(a.gauss(c),a.draw(h),a.watershed(h,this.seeds))},m));selectFilter(t)}var t=(d=document.getElementById("filterScript"))?d.getAttribute("data-name"):"";""!==
t&&(d=d.getAttribute("callback-name"),window[d?d:"initPreview"]=u,console.log("callback: %o",d))});/*
 Created by FIVEKO.com 2017

 The source code is designed and developed for educational purposes only. 
 It is designed for no other purpose and neither the authors nor their institutions 
 accept any liability concerning its use.

*/
window.addEventListener("load",function(d){function u(b){var a=b.width||b.videoWidth;b=b.height||b.videoHeight;var e=(480<document.documentElement.clientWidth?480:document.documentElement.clientWidth-100)/Math.max(a,b);c.width=a*e;c.height=b*e}function t(b,a){var e=document.getElementsByTagName("video")[0];if(!e){var f=function(){e.play();e.muted=!0;u(e);clearInterval(n);n=setInterval(function(){m.update()},30)},n,e=document.createElement("video");e.addEventListener("canplaythrough",f,!0);e.addEventListener("ended",
function(){clearInterval(n)},!0);c.onclick=function(){e.paused?f():(e.pause(),clearInterval(n))}}g=e;e.src=b}function v(b,f){a.onload=function(){u(a);c.getContext("2d").drawImage(a,0,0,c.width,c.height);f()};b?a.src=b:f();g=a}function h(b,a,e,c){this.controls=[];this.name=b;this.init=function(){this.controls=[];a.call(this);this.update.call(this)};this.update=function(){var b=new Date;c.call(this);for(var a=[],f=0;f<this.controls.length;f++)a.push(this.controls[f].value);e.apply(this,a);a=new Date;
document.getElementById("log").innerText="Elapsed: "+(a-b)+" ms"};this.reset=c}if(d=document.querySelector("div[data-role=preview]")){var m=null,a=new Image,g=a,c=document.createElement("canvas");(function(b){var a=document.getElementsByTagName("head")[0],e=document.createElement("style");e.setAttribute("type","text/css");e.styleSheet?e.styleSheet.cssText=b:e.appendChild(document.createTextNode(b));a.appendChild(e)})(".input-group-addon.title{min-width:120px;}.input-group-addon.value{width:60px;}");
var k=document.createElement("div"),p=document.createElement("input"),q=document.createElement("button"),r=document.createElement("button"),l=document.createElement("select");p.setAttribute("type","file");p.style.display="none";p.addEventListener("change",function(a){var b=URL.createObjectURL(a.target.files[0]);a=a.target.files[0].type;(a="image"==a.substring(0,5)?v:"video"==a.substring(0,5)?t:null)&&a(b,function(){URL.revokeObjectURL(b);document.getElementById("cmbFilters").onchange()})});r.textContent=
"Camera";r.style.margin="10px";r.style.width="100px";q.textContent="Browse";q.style.margin="10px";q.style.width="100px";q.onclick=function(){p.click();return!1};r.onclick=function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;navigator.getUserMedia&&navigator.getUserMedia({video:!0},function(a){var b=window.URL.createObjectURL(a);t(b,function(){URL.revokeObjectURL(b)})},function(a){alert("Failed to initialize camera!")})};
l.onchange=function(){document.getElementById("controls").innerHTML="";var a=this.options[this.selectedIndex].filter;m=this.options[this.selectedIndex].filter;a.init();return!1};l.id="cmbFilters";d.insertBefore(c,d.firstChild);d.insertBefore(k,d.firstChild);k.appendChild(p);k.appendChild(q);k.appendChild(r);k.appendChild(l);window.reloadImage=function(){c.getContext("2d").drawImage(a,0,0,c.width,c.height)};window.redraw=function(){c.getContext("2d").drawImage(g,0,0,c.width,c.height)};h.prototype.add=
function(a){this.controls.push(a)};window.selectFilter=function(a){l.style.display="none";for(var b=0;b<l.options.length;b++)if(l.options[b].text===a){l.selectedIndex=b;break}};window.addFilter=function(a){var b=document.createElement("option");b.text=a.name;b.filter=a;l.add(b)};window.Filter=h;window.createSlider=function(a,c,e,d,n,g,h,k){var b=document.createElement("div");b.innerHTML='<div class="input-group" style="max-width:420px; margin:auto;"><span class="input-group-addon title">'+e+'</span><input type="range" class="form-control" id="'+
c+'" ><span class="input-group-addon value">'+d+"</span></div>";a.appendChild(b);var f=document.getElementById(c);f.min=n;f.max=g;f.step=h;f.value=d;f.oninput=f.onchange=function(a){f.nextSibling.innerText=this.value};f.onmouseup=f.ontouchend=k;return f};window.createButton=function(a,c,e,d){var b=document.createElement("button");b.addClass="btn btn-primary";b.innerText=e;b.name=c;b.onclick=d;a.appendChild(b);return b};window.createSelector=function(a,c){var b={x:0,y:0,w:0,h:0},d={canvas:a,value:null};
a.onmousedown=function(a){b.x=a.offsetX;b.y=a.offsetY};a.onmousemove=function(c){c.buttons&&(b.w=c.offsetX-b.x,b.h=c.offsetY-b.y,c=a.getContext("2d"),redraw(),c.beginPath(),c.rect(b.x,b.y,b.w,b.h),c.stroke())};a.onmouseup=function(a){c(b)};return d};var k=d.getAttribute("data-source"),w=d.getAttribute("data-callback");v(k,function(){window[w](c,c);l.onchange();1===l.options.length&&(l.style.display="none")})}},!0);

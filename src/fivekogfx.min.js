/*
 Copyright (c) 2017 fiveko.com
 See the LICENSE file for copying permission.
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.polyfill=function(a,c,b,f){if(c){b=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var e=a[f];e in b||(b[e]={});b=b[e]}a=a[a.length-1];f=b[a];c=c(f);c!=f&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.from",function(a){return a?a:function(c,b,f){$jscomp.initSymbolIterator();b=null!=b?b:function(d){return d};var a=[],d=c[Symbol.iterator];if("function"==typeof d)for(c=d.call(c);!(d=c.next()).done;)a.push(b.call(f,d.value));else for(var d=c.length,k=0;k<d;k++)a.push(b.call(f,c[k]));return a}},"es6-impl","es3");
function FivekoGFX(a){function c(d){try{return d.getContext("webgl",{premultipliedAlpha:!1})||d.getContext("experimental-webgl",{premultipliedAlpha:!1})}catch(k){console.log("ERROR: %o",k)}return null}function b(d,c){var b=new XMLHttpRequest;b.open("GET",d,!1);b.onreadystatechange=function(){4!==b.readyState||200!==b.status&&0!=b.status||c(b.responseText);return c("")};b.send(null)}function f(d){var b=d.createTexture();d.bindTexture(d.TEXTURE_2D,b);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!0);d.texParameteri(d.TEXTURE_2D,
d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);return b}function e(d,b,c){var f=d.getAttribLocation(b,"a_position"),a=d.getUniformLocation(b,"u_image");b=d.getUniformLocation(b,"u_textureSize");d.vertexAttribPointer(f,2,d.FLOAT,!1,0,0);d.enableVertexAttribArray(f);var f=d.canvas.width,h=d.canvas.height;d.bindFramebuffer(d.FRAMEBUFFER,
c);d.uniform2f(b,f,h);d.uniform1i(a,0);d.viewport(0,0,f,h);d.drawArrays(d.TRIANGLES,0,6)}this.gl=a?c(a):c(document.createElement("canvas"));this.params={};this.programs={};this.sources={};FivekoGFX.prototype.createProgram=function(d,b,c){function f(b,d){var c=a.createShader(b);a.shaderSource(c,d);a.compileShader(c);return a.getShaderParameter(c,a.COMPILE_STATUS)?c:(alert("An error occurred compiling the shaders: "+a.getShaderInfoLog(c)),null)}var a=this.gl,h=this.programs[d];if(h)return h;c=c?f(a.VERTEX_SHADER,
c):f(a.VERTEX_SHADER,"attribute vec2 a_position;                     \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvoid main() { gl_Position = vec4(a_position, 0.0, 1.0); }");b=f(a.FRAGMENT_SHADER,b);h=a.createProgram();a.attachShader(h,c);a.attachShader(h,b);a.linkProgram(h);a.getProgramParameter(h,a.LINK_STATUS)?this.programs[d]=h:alert("Unable to initialize the shader program.");return h};FivekoGFX.prototype.createProgramFromFile=function(d,c,f,a){b(c,function(b){""!==b?(b=createProgram(d,b),a(b)):a(null)})};
FivekoGFX.prototype.deleteProgram=function(b){var c=this.gl,d=this.programs[b];d&&(c.deleteProgram(d),this.programs[b]=null)};FivekoGFX.prototype.initialize=function(b,c){var d=this.gl,a=d.canvas;if(!this.originalImageTexture||a.width!=b||a.height!=c){a.width=b;a.height=c;this.originalImageTexture=f(d);for(var e=[],k=[],n=0;2>n;++n){var g=f(d);e.push(g);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,a.width,a.height,0,d.RGBA,d.UNSIGNED_BYTE,null);var m=d.createFramebuffer();k.push(m);d.bindFramebuffer(d.FRAMEBUFFER,
m);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,g,0)}a=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a);d.bufferData(d.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),d.STATIC_DRAW);this.textures=e;this.framebuffers=k;this.count=0}};FivekoGFX.prototype.load=function(d){var b=this.gl;this.initialize(d.width,d.height);var c=window.performance.now();b.bindTexture(b.TEXTURE_2D,this.originalImageTexture);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,d);
console.log("Image loaded!Elapsed: "+(window.performance.now()-c).toString())};FivekoGFX.prototype.renderto=function(b,c){e(this.gl,b,c)};FivekoGFX.prototype.draw=function(b){var d=this.gl,c=this.createProgram("draw","precision mediump float;                                   \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tuniform sampler2D u_image;                                  \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tuniform vec2 u_textureSize;                                 \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvoid main() {                                               \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;       \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgl_FragColor = texture2D(u_image, textCoord/*vec2(textCoord.x, 1.0 - textCoord.y)*/ );          \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}                                                           ");
d.useProgram(c);e(d,c,null);this.count=0;b&&b.getContext("2d").drawImage(d.canvas,0,0)};FivekoGFX.prototype.makeTextImage2D=function(b,c,a,f,e,p,n,g){var d=this.gl,h=d.createTexture();d.activeTexture(d.TEXTURE0+c);d.bindTexture(d.TEXTURE_2D,h);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texImage2D(d.TEXTURE_2D,0,p,f,e,0,p,n,g);b=d.getUniformLocation(b,a);
d.uniform1i(b,c);d.activeTexture(d.TEXTURE0)};FivekoGFX.prototype.readPixels=function(d){var b=this.gl;d||(d={data:new Uint8Array(b.canvas.width*b.canvas.height*4),width:b.canvas.width,height:b.canvas.height});b.readPixels(0,0,b.canvas.width,b.canvas.height,b.RGBA,b.UNSIGNED_BYTE,d.data);return d};FivekoGFX.prototype.getImageData=function(b,c,a,f){var d=this.gl,e=new Uint8Array(a*f*4);d.readPixels(b,d.drawingBufferHeight-c-f,a,f,d.RGBA,d.UNSIGNED_BYTE,e);return{data:e,width:a,height:f}};FivekoGFX.prototype.execute=
function(d){var b=this.gl;e(b,d,this.framebuffers[this.count%2]);b.bindTexture(b.TEXTURE_2D,this.textures[this.count%2]);++this.count}}FivekoGFX.params={};FivekoGFX.sources={};FivekoGFX.sourceText=function(a,c){return FivekoGFX.sources[a]};
FivekoGFX.prototype.loadShaders=function(a){function c(b,c){var d=document.getElementById(c);if(!d)return null;var a="",f=d.firstChild;for(console.log(b);f;)f.nodeType==f.TEXT_NODE&&(a+=f.textContent),f=f.nextSibling;if("x-shader/x-fragment"==d.type)d=b.createShader(b.FRAGMENT_SHADER);else if("x-shader/x-vertex"==d.type)d=b.createShader(b.VERTEX_SHADER);else return null;b.shaderSource(d,a);b.compileShader(d);return b.getShaderParameter(d,b.COMPILE_STATUS)?d:(alert("An error occurred compiling the shaders: "+
b.getShaderInfoLog(d)),null)}var b=this.gl,f=c(b,a[0]);a=c(b,a[1]);var e=b.createProgram();b.attachShader(e,a);b.attachShader(e,f);b.linkProgram(e);b.getProgramParameter(e,b.LINK_STATUS)||alert("Unable to initialize the shader program.");return e};(function(a){function c(b,c){var a=b.gl,d=b.createProgram("sobel","\nprecision mediump float;\n\n#define KERNEL_SIZE 3\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nuniform float u_kernel[KERNEL_SIZE];\n#define M_PI 3.1415926535897932384626433832795\n#define GET_PIXEL(_x, _y) (texture2D(u_image, textCoord + onePixel*vec2(_x, _y)))\n \n\nvoid main() {\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tfloat dx = (length(GET_PIXEL(-1, -1)*u_kernel[0] +\n\t\t\t\tGET_PIXEL(-1,  0)*u_kernel[1] +\n\t\t\t\tGET_PIXEL(-1, +1)*u_kernel[2]) -\n\t\t\t   length(GET_PIXEL(+1, -1)*u_kernel[0] +\n\t\t\t\tGET_PIXEL(+1,  0)*u_kernel[1] +\n\t\t\t\tGET_PIXEL(+1, +1)*u_kernel[2]));\n\tfloat dy = (length(GET_PIXEL(-1, -1)*u_kernel[0] +\n\t\t\t\tGET_PIXEL(0, -1)*u_kernel[1] +\n\t\t\t\tGET_PIXEL(+1, -1)*u_kernel[2]) -\n\t\t\t   length(GET_PIXEL(-1, +1)*u_kernel[0] +\n\t\t\t\tGET_PIXEL(0, +1)*u_kernel[1] +\n\t\t\t\tGET_PIXEL(+1, +1)*u_kernel[2]));\n\n///gl_FragColor = vec4(vec3(length(vec2(dx, dy))), 1.0);\n   float theta = (atan(dy, dx) + M_PI) / (2.0*M_PI);\n   gl_FragColor = vec4(length(vec2(dx, dy)), theta, 0.0, 1.0);\n}");
a.useProgram(d);var f=a.getUniformLocation(d,"u_kernel[0]");a.uniform1fv(f,c);b.execute(d);a=b.gl;d=b.createProgram("edgeNMS","\nprecision mediump float;\n\n#define KERNEL_SIZE 3\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\n#define M_PI 3.1415926535897932384626433832795\n\nvoid main() {\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec4 cc = texture2D(u_image, textCoord);   \n\tfloat theta = degrees(cc.y*M_PI*2.0); \n\tint ax = 0, ay = 0; \n\tif ((theta >= 337.5) || (theta < 22.5))       { ax = 1; ay = 0; }\n\telse if ((theta >= 22.5) && (theta < 67.5))   { ax = 1; ay = 1; }\n\telse if ((theta >= 67.5) && (theta < 112.5))  { ax = 0; ay = 1; }\n\telse if ((theta >= 112.5) && (theta < 157.5)) { ax =-1; ay = 1; }\n\telse if ((theta >= 157.5) && (theta < 202.5)) { ax =-1; ay = 0; }\n\telse if ((theta >=202.5) && (theta < 247.5))  { ax =-1; ay =-1; }\n\telse if ((theta >=247.5) && (theta < 292.5))  { ax = 0; ay =-1; }\n\telse if ((theta >= 292.5) && (theta < 337.5)) { ax = 1; ay =-1; }\n\n\tvec4 ca = texture2D(u_image, textCoord + onePixel*vec2(ax, ay));\n\tvec4 cb = texture2D(u_image, textCoord + onePixel*vec2(-ax, -ay));\n\tgl_FragColor = vec4((((cc.x <= ca.x) || (cc.x < cb.x)) ? vec3(0) : vec3(cc.x)), 1.0);\n}");
a.useProgram(d);b.execute(d)}a.prototype.sobel=function(){c(this,[1,2,1])};a.prototype.schaar=function(){c(this,[3,10,3])};a.prototype.horizontalEdge=function(){var b=this.gl,c=this.createProgram("horizontalEdge","\nprecision mediump float;\n\n#define KERNEL_SIZE 3\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nuniform float u_kernel[KERNEL_SIZE];\n#define M_PI 3.1415926535897932384626433832795\n#define GET_PIXEL(_x, _y) (texture2D(u_image, textCoord + onePixel*vec2(_x, _y)))\n \n\nvoid main() {\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec4 dx = ((GET_PIXEL(-1, -1)*u_kernel[0] +\n\t\t\t\tGET_PIXEL(-1,  0)*u_kernel[1] +\n\t\t\t\tGET_PIXEL(-1, +1)*u_kernel[2]) -\n\t\t\t   (GET_PIXEL(+1, -1)*u_kernel[0] +\n\t\t\t\tGET_PIXEL(+1,  0)*u_kernel[1] +\n\t\t\t\tGET_PIXEL(+1, +1)*u_kernel[2]));\n\tvec4 dy = ((GET_PIXEL(-1, -1)*u_kernel[0] +\n\t\t\t\tGET_PIXEL(0, -1)*u_kernel[1] +\n\t\t\t\tGET_PIXEL(+1, -1)*u_kernel[2]) -\n\t\t\t   (GET_PIXEL(-1, +1)*u_kernel[0] +\n\t\t\t\tGET_PIXEL(0, +1)*u_kernel[1] +\n\t\t\t\tGET_PIXEL(+1, +1)*u_kernel[2]));\n\n\t\n   gl_FragColor = vec4(vec3(length(abs(dx) - abs(dy)) / 16.0), 1.0);\n}");
b.useProgram(c);var a=b.getUniformLocation(c,"u_kernel[0]");b.uniform1fv(a,[3,10,3]);this.execute(c)};a.prototype.mask=function(b){var c=this.gl,a=this.createProgram("mask3x3","\nprecision mediump float;\n\n#define KERNEL_SIZE 9\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nuniform float u_kernel[KERNEL_SIZE];\n#define GET_PIXEL(_x, _y) (texture2D(u_image, textCoord + onePixel*vec2(_x, _y)))\n\nvoid main() {\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec4 resultColor =  GET_PIXEL(-1, -1)*u_kernel[0] +\n\t\t\t\t\t\tGET_PIXEL( 0, -1)*u_kernel[1] +\n\t\t\t\t\t\tGET_PIXEL( 1, -1)*u_kernel[2] +\n\t\t\t\t\t\tGET_PIXEL(-1,  0)*u_kernel[3] +\n\t\t\t\t\t\tGET_PIXEL( 0,  0)*u_kernel[4] +\n\t\t\t\t\t\tGET_PIXEL( 1,  0)*u_kernel[5] +\n\t\t\t\t\t\tGET_PIXEL(-1,  1)*u_kernel[6] +\n\t\t\t\t\t\tGET_PIXEL( 0,  1)*u_kernel[7] +\n\t\t\t\t\t\tGET_PIXEL( 1,  1)*u_kernel[8];\n\t\t\t\t\t\t\n\n\t\n   gl_FragColor = vec4(resultColor.rgb, 1.0);\n}");
c.useProgram(a);var d=c.getUniformLocation(a,"u_kernel[0]");c.uniform1fv(d,b);this.execute(a)}})(window.FivekoGFX);(function(a){a.prototype.gauss=function(c){var b=this.gl,a=this.params.gauss;if(!a||a.sigma!==c){var a=Math.sqrt(2*Math.PI)*c,e=0,d=2*c*c,k,h=new Float32Array(15);var l=0;for(k=-7;15>l;k++,l++)h[l]=Math.exp(-(k*k)/d)/a,e+=h[l];for(k=0;15>k;k++)h[k]/=e;a={sigma:c,kernel:h};this.params.gauss=a}c=this.createProgram("gauss","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\n\n#define KERNEL_SIZE 15\nuniform vec2 u_textureSize;\nuniform int u_direction;\nuniform float u_kernel[KERNEL_SIZE];\nvoid main() {\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec2 onePixel = ((u_direction == 0) ? vec2(1.0, 0.0) : vec2(0.0, 1.0)) / u_textureSize;\n\tvec4 meanColor = vec4(0);\n\tint ms = KERNEL_SIZE / 2;\n\tfor (int i = 0; i < KERNEL_SIZE; i++)\n\t{\n\t\tmeanColor += texture2D(u_image, textCoord  + onePixel*vec2(i - ms))*u_kernel[i];\n\t}\n\tgl_FragColor = meanColor;\n}");
e=a.kernel;b.useProgram(c);d=b.getUniformLocation(c,"u_kernel[0]");a=b.getUniformLocation(c,"u_direction");b.uniform1fv(d,e);for(e=0;2>e;e++)b.uniform1i(a,e),this.execute(c)}})(window.FivekoGFX);(function(a){a.prototype.mean=function(c){var b=parseInt(c)+!(c&1);c=this.gl;b=this.createProgram("mean_size_"+b,"\nprecision mediump float;\n\n#define KERNEL_SIZE %kernelSize%\n#define KERNEL_HALF (KERNEL_SIZE / 2)\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nuniform vec2 u_direction;\n\nvoid main() {\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec2 onePixel = u_direction / u_textureSize;\n\tvec4 meanColor = vec4(0.0);\n\tfor (int i = -KERNEL_HALF; i <= KERNEL_HALF; i++)\n\t{\n\t\tmeanColor += texture2D(u_image, textCoord + onePixel*vec2(i));\n\t}\n\tgl_FragColor = meanColor / float(KERNEL_SIZE);\n}".replace(/%kernelSize%/g,
b));c.useProgram(b);var a=c.getUniformLocation(b,"u_direction");c.uniform2fv(a,[0,1]);this.execute(b);c.uniform2fv(a,[1,0]);this.execute(b)};a.prototype.blur=function(c){c=12*c*c/8;var b=this.gl,a=this.createProgram("blur3x3","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nvoid main() {\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tgl_FragColor = (\n\t\ttexture2D(u_image, textCoord + onePixel*vec2(-1.0, -1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(0.0, -1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(1.0, -1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(-1.0, 0.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(0.0,  0.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(1.0,  0.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(-1.0, 1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(0.0,  1.0)) + \n\t\ttexture2D(u_image, textCoord + onePixel*vec2(1.0,  1.0))) / 9.0;\n}");
b.useProgram(a);for(b=0;b<c;b++)this.execute(a)}})(window.FivekoGFX);(function(a){a.prototype.symmetricnn=function(c,b){var a=this.params.symmetricnn;a&&a.size!==c&&this.deleteProgram("symmetricnn");this.params.symmetricnn={size:c};var e=this.gl,a=this.createProgram("symmetricnn","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nuniform int u_pixelsCount;\n#define KERNEL_SIZE %kernelSize%\n#define HALF_SIZE (KERNEL_SIZE / 2)\n\nvoid main() {\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tvec4 meanColor = vec4(0);\n\tvec4 v = texture2D(u_image, textCoord);\n\tint count = 0;\n\tfor (int y = 0; y <= HALF_SIZE; y++){\n\t\tfor (int x = -HALF_SIZE; x <= HALF_SIZE; x++){\n\t\t\tvec4 v1 = texture2D(u_image, textCoord + vec2(x, y) * onePixel);  \n\t\t\tvec4 v2 = texture2D(u_image, textCoord + vec2(-x, -y) * onePixel);\n\t\t\tvec4 d1 = abs(v - v1);\n\t\t\tvec4 d2 = abs(v - v2);\n\t\t\tvec4 rv = vec4(((d1[0] < d2[0]) ? v1[0] : v2[0]),\n\t\t\t\t\t\t\t((d1[1] < d2[1]) ? v1[1] : v2[1]),\n\t\t\t\t\t\t\t((d1[2] < d2[2]) ? v1[2] : v2[2]),1);\n\t\t\tmeanColor += rv;\n\t\t}\n\t}\n\tgl_FragColor = meanColor / float(u_pixelsCount);\n}".replace(/%kernelSize%/g,
c));e.useProgram(a);var d=(c+!(c%2))*((c+!(c%2))/2+.5),k=e.getUniformLocation(a,"u_pixelsCount");e.uniform1i(k,d);console.log("size:"+c+" count: "+d);for(e=0;e<b;e++)this.execute(a)}})(window.FivekoGFX);(function(a){a.prototype.houghCircle=function(a){var b=this.gl,c=this.createProgram("houghCircle","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nuniform float u_r;\n#define M_PI 3.1415926535897932384626433832795\n#define PHI_STEP M_PI/180.0\n\nvoid main() {\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec4 sum = vec4(0.0);\n\tfloat phi = 0.0;\n\tfor (int i = 0; i < 360; i++)\n\t{\n\t\tphi += PHI_STEP;\n\t\tsum += texture2D(u_image, textCoord + onePixel*vec2(u_r*cos(phi), u_r*sin(phi)));\n\t}\n\t\n\tgl_FragColor = vec4(vec3(sum / 360.0), 1.0);\n}");
b.useProgram(c);b.uniform1f(b.getUniformLocation(c,"u_r"),a);this.execute(c)};a.prototype.houghLines=function(a){a=this.gl;var b=this.createProgram("houghLines","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform sampler2D u_linesTable;\nuniform vec2 u_textureSize;\nuniform float u_r;\n#define M_PI 3.1415926535897932384626433832795\n#define PHI_STEP M_PI/180.0\n\nvoid main() {\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec4 sum = vec4(0.0);\n\tfloat phi = 0.0;\n\tfor (int i = 0; i < 180; i++)\n\t{\n\t\tphi += PHI_STEP;\n\t\tsum += texture2D(u_image, textCoord + onePixel*vec2(u_r*cos(phi), u_r*sin(phi)));\n\t}\n\t\n\tgl_FragColor = vec4(vec3(sum / 360.0), 1.0);\n}");
a.useProgram(b);var c=new Float32Array(Math.sqrt(a.canvas.width*a.canvas.width+a.canvas.height*a.canvas.height));this.makeTextImage2D(b,1,"u_linesTable",c.length,1,a.LUMINANCE,a.FLOAT,c);a.activeTexture(a.TEXTURE1);this.execute(b)}})(window.FivekoGFX);(function(a){function c(b,a){var c=this.gl,d=this.createProgram(b,a);c.useProgram(d);this.execute(d)}a.prototype.rgb2grey=function(){c.call(this,"rgb2grey","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nvec4 scale = vec4(0.299,  0.587,  0.114, 0.0);\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\tgl_FragColor = vec4(vec3(dot(color,scale)), color.a);\n}")};a.prototype.rgb2luma=function(){c.call(this,"rgb2lum",
shaderSourceRGB2LUMA)};a.prototype.rgb2ycbcr=function(){c.call(this,"rgb2ycbcr","\nprecision mediump float; \n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize; \nmat4 scale =   mat4(0.257,  0.504,  0.098, 0.0, \n                   -0.148, -0.291,  0.439, 0.0, \n                    0.439, -0.368, -0.071, 0.0, \n                    1.0, 1.0,  1.0, 1.0 );\n\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\tgl_FragColor = color*scale + vec4(0.0625, 0.5, 0.5, 0);\n}")};
a.prototype.ycbcr2rgb=function(){c.call(this,"ycbcr2rgb","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nmat4 scale =   mat4(1.164,  0.000,  1.596, 0.0,\n                    1.164, -0.392, -0.813, 0.0,\n                    1.164,  2.017,  0.000, 0.0,\n                    1.0, 1.0,  1.0, 1.0 );\n\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\tgl_FragColor = (color- vec4(0.0625, 0.5, 0.5, 0))*scale ;\n}")};
a.prototype.skinMask=function(){var b=this.gl,a=this.createProgram("skinMask","\nprecision mediump float;\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nvec4 thr = vec4(80.0/255.0, 120.0/255.0, 133.0/255.0, 173.0/255.0);\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\tgl_FragColor = vec4(vec3(( (color[0] > thr[0]) && \n\t\t\t\t(color[1] >= thr[0]) && (color[1] <= thr[1]) && \n\t\t\t\t(color[2] >= thr[2]) && (color[2] <=thr[3])) ? 1.0 : 0.0), \n\t\t\t\tcolor.a);\n}");
this.rgb2ycbcr();b.useProgram(a);this.execute(a)};a.prototype.rgb2xyz=function(){c.call(this,"rgb2xyz","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\n#define SCALE(_c) (((_c) > 0.04045) ? (pow(((_c) + 0.055 ) / 1.055, 2.4)) : ((_c)/ 12.92))\nmat4 scale =   mat4(0.4124,  0.3576,  0.1805, 0.0, \n                    0.2126,  0.7152,  0.0722, 0.0, \n                    0.0193,  0.1192,  0.9505, 0.0, \n                    1.0, 1.0,  1.0, 1.0 );\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\tvec4 rgb = vec4(SCALE(color.r), SCALE(color.g), SCALE(color.b), color.a); \n\tgl_FragColor = rgb*scale;\n}")};
a.prototype.rgb2hsl=function(){c.call(this,"rgb2hsl","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\n\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\tfloat cMin = min(min(color.r, color.g), color.b);\n\tfloat cMax = max(max(color.r, color.g), color.b);\n\tfloat L = (cMax + cMin)/(2.0);\n\t\n\tif (cMin == cMax){\n\t\tgl_FragColor = vec4(vec3(0, 0, L), color.a); \n\t\treturn;\n\t}\n\t// Calc Saturation\n\tfloat delta = (cMax - cMin);\n\tfloat S = ((L > 0.5) ? (delta / (2.0 - cMax - cMin)) : (delta / (cMax + cMin)));\n\t\n\t// Calc Hue\n\tfloat H = (color.r == cMax) ? (((color.g - color.b) / delta)) :\n\t\t\t\t((color.g == cMax) ? (2.0 + (color.b - color.r) / delta) :\n\t\t\t\t((4.0 + (color.r - color.g) / delta)));\n\tH = ((H < 0.0) ? (H + 6.0) : H) / 6.0;\n\tgl_FragColor = vec4(vec3(H, S, L), color.a);\n}")};
a.prototype.colormap=function(b){var a=this.gl,c=this.createProgram("colormap","\nprecision mediump float;\n\n// our texture\nuniform vec2 u_textureSize;\nuniform sampler2D u_image;\nuniform sampler2D u_colorTable;\n\nvoid main() {\n\tvec2 pos = vec2(texture2D(u_image, gl_FragCoord.xy / u_textureSize).x, 0.0);\n\tvec4 color = texture2D(u_colorTable, pos);\n\t\n\tgl_FragColor = color;\n}");a.useProgram(c);this.makeTextImage2D(c,1,"u_colorTable",b.length,1,a.LUMINANCE,a.UNSIGNED_BYTE,b);this.execute(c)};
a.prototype.rgb2bin=function(a){var b=this.gl,c=this.createProgram("rgb2bin","\nprecision mediump float;\n\n// our texture\nuniform vec2 u_textureSize;\nuniform sampler2D u_image;\nuniform vec4 u_threshold;\n\nvoid main() {\n\tvec4 color = texture2D(u_image, gl_FragCoord.xy / u_textureSize);\n\t\n\tgl_FragColor = vec4(greaterThan(color, u_threshold));\n}");b.useProgram(c);b.uniform4fv(b.getUniformLocation(c,"u_threshold"),a);this.execute(c)}})(window.FivekoGFX);(function(a){function c(a,c){function d(a,b){return e[a+1]-e[b+1]}function f(a){for(var b=0;4>b;b++){var c=a+p[b];if(0===e[c]){e[c]=e[a];var f=l[a+0]+l[c+0]>>>1,k=l[a+0]-l[c+0],g=l[a+1]-l[c+1],h=l[a+2]-l[c+2];e[c+1]=Math.sqrt(((512+f)*k*k>>8)+4*g*g+((767-f)*h*h>>8));r.push(c,d)}}}for(var e=new a.data.constructor(new ArrayBuffer(a.data.length)),l=a.data,r=new b,p=[-4,4,4*-a.width,4*a.width],n=4*a.width,g=0,m=n*a.height;g<n;g+=4)e[g]=e[g+m]=255;g=0;for(m=a.height*n;g<m;g+=n)e[g]=e[g+n-1]=255;g=0;for(m=
c.length;c[g];g++)for(var m=c[g].pixels,q=0,t=m.length;q<t;q++)e[m[q]]=80*(g+1),f(m[q]);for(;!r.empty();)m=r.pop(),f(m);g=n+4;for(m=n*a.height-n;g<m;g+=4)160==e[g]&&(l[g+1]=l[g+2]=255*p.reduce(function(a,b){return a|e[g]^e[g+b]},0))}var b=function(){this.nodes=[]};b.prototype.push=function(a,b){for(var c=this.nodes,f=0,e=c.length;f<e;){var l=f+e>>>1;0>b(a,c[l])?f=l+1:e=l}c.splice(f,0,a)};b.prototype.pop=function(){return this.nodes.pop()};b.prototype.empty=function(){return 0===this.nodes.length};
b.prototype.size=function(){return this.nodes.length};a.prototype.watershed=function(a,b){var d=a.getContext("2d"),f=d.getImageData(0,0,a.width,a.height);c(f,b);d.putImageData(f,0,0)}})(window.FivekoGFX);(function(a){a.prototype.histogram=function(a){a=this.getImageData(a.x,a.y,a.w,a.h).data;for(var b=Array.from({length:3},function(){return new Uint32Array(256)}),c=0,e=a.length;c<e;c+=4)b[0][a[c+0]]++,b[1][a[c+1]]++,b[2][a[c+2]]++;return b};a.prototype.equalize=function(a){var b=0,c=0;a=a.map(function(a){c+=a;b=b||c;return c});return Uint8Array.from(a,function(a){return 0<a?255*(a-b)/(c-b):0})};a.prototype.normalize=function(a){var b=Math.min.apply(null,a),c=Math.max.apply(null,a)-b||1;return Uint8Array.from(a,
function(a){return 255*(a-b)/c})}})(window.FivekoGFX);(function(a){a.prototype.logpolar=function(){var a=this.gl,b=this.createProgram("logpolar","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\nconst float PI = atan(1.0, 0.0)*2.0;\nconst float PI_2 = 2.0*PI;\n#define IN_RANGE(v_) (((v_) >= 0.0) && ((v_) <= 1.0))\n\nvoid main() {\n\tvec2 p = gl_FragCoord.xy / u_textureSize;\n\tfloat radius = (exp(p.x) - 1.0)/1.718281828459045;\n\tfloat angle = PI + PI_2*p.y;\n\tvec2 polar = vec2(radius*cos(angle), radius*sin(angle)) + vec2(0.5);\n\tif (IN_RANGE(polar.x) && IN_RANGE(polar.y))\n\t\tgl_FragColor = texture2D(u_image, polar);\n\telse\n\t\tgl_FragColor = vec4(vec3(0.0), 1.0);\n}");
a.useProgram(b);this.execute(b)}})(window.FivekoGFX);(function(a){a.prototype.lbp=function(){var a=this.gl,b=this.createProgram("lbp","\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\nuniform vec2 u_textureSize;\n#define GET_PIXEL(_x, _y) (texture2D(u_image, textCoord + onePixel*vec2(_x, _y)))\n#define CMP(_x, _y) vec4(greaterThanEqual((_x), (_y)))\n\nvoid main() {\n\tvec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\tvec2 textCoord = gl_FragCoord.xy / u_textureSize;\n\tvec4 color = GET_PIXEL(0, 0);\n\tvec4 value = CMP(color, GET_PIXEL(-1, -1))*0.5 +\n\t\t\t\t CMP(color, GET_PIXEL(-1,  0))*0.25 +\n\t\t\t\t CMP(color, GET_PIXEL(-1,  1))*0.125 +\n\t\t\t\t CMP(color, GET_PIXEL( 0,  1))*0.0625 +\n\t\t\t\t CMP(color, GET_PIXEL( 1,  1))*0.03125 +\n\t\t\t\t CMP(color, GET_PIXEL( 1,  0))*0.015625 +\n\t\t\t\t CMP(color, GET_PIXEL( 1, -1))*0.0078125 +\n\t\t\t\t CMP(color, GET_PIXEL( 0, -1))*0.00390625;\n\n\tgl_FragColor = vec4(value.rgb, 1.0);\n}");
a.useProgram(b);this.execute(b)}})(window.FivekoGFX);
